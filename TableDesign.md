## テーブル設計 ##

テーブル設計の議論は [Issue 27](https://code.google.com/p/personal-work-recorder/issues/detail?id=27) を参照

### タスクマスタ ###
#### [概要] ####
作業タスクを登録する

基本的に入力する時のドロップダウンリストに表示するためのテーブルなので、10個程度を残してどんどん削除される想定

**テーブル名** tasks
| **物理名**    | **項目名**   | **タイプなど**                      |
|:-----------|:----------|:-------------------------------|
| `_id`      | ID         | INTEGER PRIMARY KEY AUTOINCREMENT |
| code        | 作業コード     | TEXT                              |
| description | 作業内容      | TEXT                              |

### 勤務実績 ###
#### [概要] ####
一日の作業時間を記録する

開始ボタンを押した時にレコードが作成され、終了ボタンで終了日時をセットする

アプリケーションが中断(あるいは終了)して、再開する場合は続きから再開する。終了日時が null 値のものが現在記録中のレコード

終了ボタンが押されるまで、ずっと仕事をしていることになるので、押し忘れた場合の対応は別に考える

**テーブル名** work\_records
| **物理名**    | **項目名**   | **タイプなど**                      |
|:-----------|:----------|:-------------------------------|
| `_id`      | ID         | INTEGER PRIMARY KEY AUTOINCREMENT |
| start       | 勤務開始日時    | INTEGER                           |
| end         | 勤務終了日時    | INTEGER                           |

SQLite3 には日付タイプがないので、1970/1/1 00:00:00 からの\*ミリ秒\*で日時を保存する。
SQLite3 の日付関数(strftimeなど)は 1970/1/1 00:00:00 からの\*秒数\*を受け取ることを想定しているので注意が必要。


### タスク実績 ###
#### [概要] ####
各タスクの実行を記録する

タスクの開始時刻だけを記録して、別のタスクが開始したらそれが今のタスクの終了と見なす。

タスクの実績は、勤務実績と紐付けられ、1日の仕事の明細を形成する

各レコードは作成されるだけ、更新されない

各タスクにはタスクコードとタスク名がマスターとは別途記録される。マスターには直近のタスク10個程度が登録されているが、タスク実績には過去分がずっと残される。

**テーブル名** task\_records
| **物理名**    | **項目名**   | **タイプなど**                      |
|:-----------|:----------|:-------------------------------|
| `_id`      | ID         | INTEGER PRIMARY KEY AUTOINCREMENT |
| work\_id     | 勤務ID      | INTEGER (FOREIGN KEY)             |
| start       | 作業開始日時    | INTEGER                         |
| code        | 作業コード     | TEXT                              |
| description | 作業内容      | TEXT                              |


### 例 ###

tasks
|`_id`| code | description|
|:----|:-----|:-----------|
|    1    | A001 | ○○業務 打ち合わせ |
|    2    | A002 | ○○業務 基本設計  |
|    3    | B001 | ××業務 品質レビュー |
|    4    | Z001 | 休憩         |

work\_records
|`_id`| start               | end |
|:----|:--------------------|:----|
|    1    | 2011/12/05 09:00:00 | 2011/12/05 19:00:00 |
|    2    | 2011/12/06 10:00:00 | null |

task\_records
|`_id`| work\_id | start               | code | description |
|:----|:---------|:--------------------|:-----|:------------|
|    1    |   1      | 2011/12/05 09:00:00 | A003 | ○○業務 要件定義   |
|    2    |   1      | 2011/12/05 12:00:00 | Z001 | 休憩          |
|    3    |   1      | 2011/12/05 13:00:00 | B001 | ××業務 品質レビュー |
|    4    |   1      | 2011/12/05 15:00:00 | C001 | △△業務 打ち合わせ  |
|    5    |   1      | 2011/12/05 17:00:00 | A003 | ○○業務 要件定義   |
|    6    |   2      | 2011/12/06 10:00:00 | A001 | ○○業務 打ち合わせ  |
|    7    |   2      | 2011/12/06 12:00:00 | Z001 | 休憩 (ここから再開) |

### 日次勤務集計 ###
#### [概要] ####
勤務実績のサマリー
勤務実績の開始／終了は 1日のうちで自由に押せるので、1日の最も早い開始と最も遅い終了をその日の勤務実績集計とする。

勤務実績はミリ秒単位で保存されるが、日次勤務集計はそれを15分刻みで調整して記録する想定

**テーブル名** daily\_work\_summary
| **物理名**    | **項目名**     | **タイプなど**                      |
|:-----------|:------------|:-------------------------------|
| `_id`      | ID           | INTEGER PRIMARY KEY AUTOINCREMENT |
| start\_at    | 勤務開始日時      | INTEGER (1970/1/1 からのミリ秒)      |
| end\_at      | 勤務終了日時      | INTEGER (1970/1/1 からのミリ秒)      |

### 例 ###

work\_records
|`_id`| start               | end                 |
|:----|:--------------------|:--------------------|
|    1    | 2012/01/04 09:02:37 | 2012/01/04 14:17:12 |
|    2    | 2012/01/04 14:23:12 | 2012/01/04 18:17:02 |
|    3    | 2012/01/05 08:57:21 | 2012/01/05 19:10:12 |

という勤務実績があった場合、2012/01/04 の勤務実績サマリーは

daily\_work\_summary
|`_id`| start\_at            | end\_at              |
|:----|:---------------------|:---------------------|
|    1    | 2012/01/04 09:02:37  | 2012/01/04 18:17:02  |

となり、画面でこれを調整し

daily\_work\_summary
|`_id`| start\_at            | end\_at              |
|:----|:---------------------|:---------------------|
|    1    | 2012/01/04 09:00:00  | 2012/01/04 18:15:00  |

のように保存される想定

### 日次作業集計 ###
#### [概要] ####
作業実績のサマリー
勤務実績に紐づく、作業明細の集計。1日の中で同じ作業を複数回記録することもあるが、作業コードごとにサマリーする

**テーブル名** daily\_task\_summary
| **物理名**              | **項目名**     | **タイプなど**                      |
|:---------------------|:------------|:-------------------------------|
| `_id`                | ID           | INTEGER PRIMARY KEY AUTOINCREMENT |
| code                  | 作業コード       | TEXT                              |
| description           | 作業内容        | TEXT                              |
| duration              | 作業時間        | INTEGER (ミリ秒で記録)               |
| daily\_work\_summary\_id | 勤務集計ID      | INTEGER (daily\_work\_summary の外部KEY) |

作業時間もミリ秒単位で保持する。こちらも画面から 15分きざみで調整される想定。